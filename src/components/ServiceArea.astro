---
import { MapPin, CheckCircle } from 'lucide-astro';
import type { Translations } from '../types';

interface Props {
  t: Translations;
}

const { t } = Astro.props;
---

<section class="py-20 bg-white" id="service-area">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold text-gray-900 mb-4">{t.serviceArea.title}</h2>
      <div class="w-24 h-1 bg-gradient-to-r from-cyan-dark to-cyan-light mx-auto mb-6"></div>
      <p class="text-2xl text-cyan-dark font-semibold mb-4">{t.serviceArea.subtitle}</p>
      <p class="text-lg text-gray-600 max-w-3xl mx-auto leading-relaxed">
        {t.serviceArea.description}
      </p>
    </div>

    <!-- Content Grid -->
    <div class="grid lg:grid-cols-2 gap-12 items-start">
      
      <!-- Map Section -->
      <div class="order-2 lg:order-1">
        <div class="relative rounded-2xl overflow-hidden shadow-2xl border-4 border-cyan-dark">
          <!-- Leaflet Map Container -->
          <div id="colorado-map" class="w-full h-[500px]"></div>
          
          <!-- Map Overlay Badge -->
          <div class="absolute top-6 left-6 bg-yellow-custom text-cyan-dark px-6 py-3 rounded-xl shadow-lg font-bold flex items-center gap-2 z-[1000] pointer-events-none">
            <MapPin class="w-5 h-5" />
            <span>{t.serviceArea.coverage}</span>
          </div>
        </div>
      </div>

      <!-- Cities List Section -->
      <div class="order-1 lg:order-2">
        <div class="bg-gradient-to-br from-cyan-dark to-[#034a43] rounded-2xl p-8 shadow-2xl">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-xl bg-yellow-custom flex items-center justify-center">
              <MapPin class="w-6 h-6 text-cyan-dark" />
            </div>
            <h3 class="text-2xl font-bold text-white">
              {t.serviceArea.cities}
            </h3>
          </div>

          <ul class="space-y-4">
            {t.serviceArea.cityList.map((city) => (
              <li class="flex items-start gap-3 text-white group">
                <div class="flex-shrink-0 mt-1">
                  <CheckCircle class="w-5 h-5 text-yellow-custom group-hover:scale-110 transition-transform duration-300" />
                </div>
                <span class="text-lg">{city}</span>
              </li>
            ))}
          </ul>

          <!-- CTA Button -->
          <div class="mt-8 pt-8 border-t border-white/20">
            <a
              href="tel:+17205550123"
              class="w-full inline-flex items-center justify-center gap-3 bg-yellow-custom hover:bg-white text-cyan-dark font-bold px-8 py-4 rounded-xl shadow-xl transition-all duration-300"
            >
              <MapPin class="w-5 h-5" />
              <span>{t.contact.cta}</span>
            </a>
          </div>
        </div>

        <!-- Additional Info Card -->
        <div class="mt-6 bg-gray-50 rounded-xl p-6 border-2 border-gray-200">
          <p class="text-gray-700 text-sm leading-relaxed">
            <span class="font-semibold text-cyan-dark">Note:</span> We're committed to providing quality service throughout Colorado. If your location isn't listed, please contact us - we may still be able to help!
          </p>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #colorado-map {
    z-index: 1;
  }

  /* Custom marker styles */
  .custom-marker {
    background-color: #067f75;
    border: 3px solid white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    animation: marker-pulse 2s infinite;
  }

  @keyframes marker-pulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    50% {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(6, 127, 117, 0.5);
    }
  }

  .leaflet-popup-content-wrapper {
    background-color: #067f75;
    color: white;
    border-radius: 12px;
    font-weight: bold;
    padding: 8px;
  }

  .leaflet-popup-tip {
    background-color: #067f75;
  }
</style>

<!-- Leaflet JS -->
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize map centered on Colorado
    const map = L.map('colorado-map', {
      zoomControl: true,
      scrollWheelZoom: false,
      dragging: true,
      doubleClickZoom: true
    }).setView([39.5501, -105.7821], 7);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 18,
    }).addTo(map);

    // Custom icon
    const customIcon = L.divIcon({
      className: 'custom-marker',
      html: '<div style="width: 100%; height: 100%; background-color: #067f75; border-radius: 50%; border: 3px solid white;"></div>',
      iconSize: [30, 30],
      iconAnchor: [15, 15],
      popupAnchor: [0, -15]
    });

    // Cities data with coordinates
    const cities = [
      { name: 'Denver', lat: 39.7392, lng: -104.9903, info: 'Denver Metropolitan Area - Capital of Colorado' },
      { name: 'Colorado Springs', lat: 38.8339, lng: -104.8214, info: 'Second largest city in Colorado' },
      { name: 'Aurora', lat: 39.7294, lng: -104.8319, info: 'Third largest city in Colorado' },
      { name: 'Fort Collins', lat: 40.5853, lng: -105.0844, info: 'Home to Colorado State University' },
      { name: 'Boulder', lat: 40.0150, lng: -105.2705, info: 'University town with mountain views' },
      { name: 'Pueblo', lat: 38.2544, lng: -104.6091, info: 'Historic steel town of Colorado' }
    ];

    // Add markers for each city
    cities.forEach(city => {
      const marker = L.marker([city.lat, city.lng], { icon: customIcon }).addTo(map);
      
      marker.bindPopup(`
        <div style="text-align: center; padding: 4px;">
          <strong style="font-size: 16px; color: #FFC519;">${city.name}</strong><br>
          <span style="font-size: 12px; color: white;">${city.info}</span>
        </div>
      `);

      // Add hover effect
      marker.on('mouseover', function() {
        this.openPopup();
      });
    });

    // Add circles for service areas
    cities.forEach(city => {
      L.circle([city.lat, city.lng], {
        color: '#FFC519',
        fillColor: '#FFC519',
        fillOpacity: 0.15,
        radius: city.name === 'Denver' ? 35000 : 25000,
        weight: 2
      }).addTo(map);
    });

    // Fit bounds to show all cities
    const bounds = L.latLngBounds(cities.map(city => [city.lat, city.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
  });
</script>
